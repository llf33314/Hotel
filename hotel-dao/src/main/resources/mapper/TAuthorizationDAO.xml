<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gt.hotel.dao.TAuthorizationDAO">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.gt.hotel.entity.TAuthorization">
		<id column="id" property="id" />
		<result column="account_id" property="accountId" />
		<result column="hotel_id" property="hotelId" />
		<result column="function_ids" property="functionIds" />
		<result column="scan_code_authorization" property="scanCodeAuthorization" />
		<result column="mark_modified" property="markModified" />
		<result column="created_by" property="createdBy" />
		<result column="created_at" property="createdAt" />
		<result column="updated_by" property="updatedBy" />
		<result column="updated_at" property="updatedAt" />
		<result column="member_id" property="memberId" />
	</resultMap>

	<!-- 通用查询结果列 -->
	<sql id="Base_Column_List">
		id, account_id, hotel_id, function_ids, scan_code_authorization,
		mark_modified, created_by, created_at, updated_by, updated_at, member_id
	</sql>
	<sql id="Base_Column_List_VO">
		t_authorization.id, t_authorization.account_id accountId, t_authorization.hotel_id hotelId,
		t_authorization.function_ids functionIds, t_authorization.scan_code_authorization
		scanCodeAuthorization, t_authorization.mark_modified markModified,
		t_authorization.created_by createdBy,
		t_authorization.created_at createdAt, t_authorization.updated_by updatedBy,
		t_authorization.updated_at updatedAt, t_authorization.member_id memberId
	</sql>

	<select id="queryAuthor" resultType="com.gt.hotel.vo.AuthorizationVo">
		SELECT
		<include refid="Base_Column_List_VO" />, t_hotel.`name` hotelName,
		(SELECT GROUP_CONCAT(dict_cn_name) FROM sys_dictionary WHERE FIND_IN_SET(sys_dictionary.id, t_authorization.function_ids)) functions 
		FROM t_authorization JOIN t_hotel ON t_authorization.hotel_id = t_hotel.id 
		WHERE t_authorization.mark_modified = 0 
		<if test="hotelId != null">
			AND t_authorization.hotel_id = #{hotelId} 
		</if>
		GROUP BY t_authorization.account_id 
	</select>

</mapper>
