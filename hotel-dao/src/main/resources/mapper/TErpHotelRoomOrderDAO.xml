<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gt.hotel.dao.TErpHotelRoomOrderDAO">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.gt.hotel.entity.TErpHotelRoomOrder">
		<id column="id" property="id" />
		<result column="hotel_id" property="hotelId" />
		<result column="bus_id" property="busId" />
		<result column="check_in_mode" property="checkInMode" />
		<result column="check_in_standard" property="checkInStandard" />
		<result column="price" property="price" />
		<result column="quantity" property="quantity" />
		<result column="if_cash_pledge" property="ifCashPledge" />
		<result column="cash_pledge" property="cashPledge" />
		<result column="order_number" property="orderNumber" />
		<result column="check_in_time" property="checkInTime" />
		<result column="check_out_time" property="checkOutTime" />
		<result column="create_time" property="createTime" />
		<result column="pay_type" property="payType" />
		<result column="pay_time" property="payTime" />
		<result column="pay_status" property="payStatus" />
		<result column="order_status" property="orderStatus" />
		<result column="remark" property="remark" />
		<result column="source" property="source" />
		<result column="available" property="available" />
	</resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, hotel_id AS hotelId, bus_id AS busId, check_in_mode AS checkInMode, check_in_standard AS checkInStandard, price, quantity, if_cash_pledge AS ifCashPledge, cash_pledge AS cashPledge, order_number AS orderNumber, check_in_time AS checkInTime, check_out_time AS checkOutTime, create_time AS createTime, pay_type AS payType, pay_time AS payTime, pay_status AS payStatus, order_status AS orderStatus, remark, source, available 
    </sql>

	<select id="selectRoomOrderExport" parameterType="Map" resultType="com.gt.hotel.entity.TErpHotelRoomOrderEx">
		SELECT a.id, c.`name`, b.book_name bookName, b.book_phone, a.check_in_time checkInTime, a.check_out_time, a.check_in_standard, a.price, a.quantity, a.order_status, a.pay_status, a.pay_type 
		FROM t_erp_hotel_room_order a 
		LEFT JOIN t_erp_hotel_room_order_guest b ON a.id = b.order_id 
		LEFT JOIN t_erp_hotel c ON a.hotel_id = c.id 
		WHERE b.guest_type = 0 
		<if test="id != null">
			AND a.id = #{id} 
		</if> 
		<if test="bus_id != null">
			AND a.bus_id = #{bus_id} 
		</if>
		<if test="hotelId != null">
			AND c.id = #{hotelId} 
		</if>
		<if test="orderStatus != null">
			AND a.order_status = #{orderStatus} 
		</if>
		<if test="payStatus != null">
			AND a.pay_status = #{payStatus} 
		</if>
		<if test="check_in_time != null">
			<![CDATA[ AND a.check_in_time >= #{check_in_time} ]]>
		</if>
		<if test="check_out_time != null">
			<![CDATA[ AND a.check_out_time <= #{check_out_time} ]]> 
		</if>
		<if test="keyword != null and keyword != ''">
			AND (b.book_name LIKE #{keyword} OR b.book_phone LIKE #{keyword}) 
		</if>
		<if test="page != null">
			LIMIT #{page},#{pageSize} 
		</if>
	</select>
	
	<select id="selectRoomOrderExportCount" parameterType="Map" resultType="Integer">
		SELECT COUNT(a.id)  
		FROM t_erp_hotel_room_order a 
		LEFT JOIN t_erp_hotel_room_order_guest b ON a.id = b.order_id 
		LEFT JOIN t_erp_hotel c ON a.hotel_id = c.id 
		WHERE b.guest_type = 0
		<if test="id != null">
			AND a.id = #{id} 
		</if> 
		<if test="bus_id != null">
			AND a.bus_id = #{bus_id} 
		</if>
		<if test="hotelId != null">
			AND c.id = #{hotelId} 
		</if>
		<if test="orderStatus != null">
			AND a.order_status = #{orderStatus} 
		</if>
		<if test="payStatus != null">
			AND a.pay_status = #{payStatus} 
		</if>
		<if test="check_in_time != null">
			<![CDATA[ AND a.check_in_time >= #{check_in_time} ]]>
		</if>
		<if test="check_out_time != null">
			<![CDATA[ AND a.check_out_time <= #{check_out_time} ]]> 
		</if>
		<if test="keyword != null and keyword != ''">
			AND (b.book_name LIKE #{keyword} OR b.book_phone LIKE #{keyword}) 
		</if>
	</select>
	
	<update id="updateOrderDel">
		UPDATE t_erp_hotel_room_order SET available = 0 
		WHERE id IN 
		<foreach collection="list" item="item" index="index" open="(" close=")" separator=",">
            #{item}
        </foreach>
	</update>
	
	<update id="updateStatus" parameterType="com.gt.hotel.entity.TErpHotelRoomOrder">
		UPDATE t_erp_hotel_room_order SET order_status = #{orderStatus} 
		WHERE id = #{id} 
	</update>
	
</mapper>
