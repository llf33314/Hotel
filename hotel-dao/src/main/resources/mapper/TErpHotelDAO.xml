<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gt.hotel.dao.TErpHotelDAO">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.gt.hotel.entity.TErpHotel">
		<id column="id" property="id" />
		<result column="bus_id" property="busId" />
		<result column="shop_id" property="shopId" />
		<result column="name" property="name" />
		<result column="introduction" property="introduction" />
		<result column="phone" property="phone" />
		<result column="address" property="address" />
		<result column="longitude" property="longitude" />
		<result column="latitude" property="latitude" />
		<result column="if_reserve_man" property="ifReserveMan" />
		<result column="if_reserve_phone" property="ifReservePhone" />
		<result column="if_remark" property="ifRemark" />
		<result column="pay_mode" property="payMode" />
		<result column="if_sms" property="ifSms" />
		<result column="sms_phone" property="smsPhone" />
		<result column="if_check_out" property="ifCheckOut" />
		<result column="if_food" property="ifFood" />
		<result column="if_bulletin" property="ifBulletin" />
		<result column="bulletin" property="bulletin" />
		<result column="if_remnant_room" property="ifRemnantRoom" />
		<result column="if_continue" property="ifContinue" />
		<result column="if_confirm_info" property="ifConfirmInfo" />
		<result column="if_breakfast" property="ifBreakfast" />
		<result column="breakfast_quantity" property="breakfastQuantity" />
		<result column="if_activity_prices" property="ifActivityPrices" />
		<result column="if_free_deposit" property="ifFreeDeposit" />
		<result column="if_last_check_out" property="ifLastCheckOut" />
		<result column="if_group_buy" property="ifGroupBuy" />
		<result column="if_spike" property="ifSpike" />
		<result column="if_hour" property="ifHour" />
		<result column="if_special" property="ifSpecial" />
		
		<result column="food_pay_mode" property="foodPayMode" />
		<result column="check_out_phone" property="checkOutPhone" />
		<result column="if_invoice" property="ifInvoice" />
		<result column="neek_prompt" property="neekPrompt" />
		<result column="unneek_prompt" property="unneekPrompt" />
		
		<result column="creator" property="creator" />
		<result column="create_time" property="createTime" />
		<result column="update_time" property="updateTime" />
	</resultMap>
	
	<resultMap id="BaseResultMapVO" type="com.gt.hotel.entity.TErpHotelAndImage" extends="BaseResultMap">
		<result column="business_name" property="businessName" />
		<result column="telephone" property="telephone" />
		<result column="businessAddress" property="businessAddress" />
		<result column="logoName" property="logoName" />
		<result column="logoUrl" property="logoUrl" />
	</resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, bus_id AS busId, shop_id AS shopId, name, introduction, phone, address, longitude, latitude, 
        if_reserve_man AS ifReserveMan, if_reserve_phone AS ifReservePhone, if_remark AS ifRemark, pay_mode AS payMode, 
        if_sms AS ifSms, sms_phone AS smsPhone, if_check_out AS ifCheckOut, if_food AS ifFood, if_bulletin AS ifBulletin, 
        bulletin, if_remnant_room AS ifRemnantRoom, if_continue AS ifContinue, if_confirm_info AS ifConfirmInfo, 
        if_breakfast AS ifBreakfast, breakfast_quantity AS breakfastQuantity, if_activity_prices AS ifActivityPrices, 
        if_free_deposit AS ifFreeDeposit, if_last_check_out AS ifLastCheckOut, if_group_buy AS ifGroupBuy, if_spike AS ifSpike, 
        if_hour AS ifHour, if_special AS ifSpecial, food_pay_mode AS foodPayMode, check_out_phone AS checkOutPhone, if_invoice AS ifInvoice, 
        neek_prompt AS neekPrompt, unneek_prompt AS unneekPrompt, creator, create_time AS createTime, update_time AS updateTime 
    </sql>

	<select id="selectHotelAndImagePage" resultMap="BaseResultMapVO" parameterType="Map">
		SELECT a.id, a.bus_id, a.shop_id, a.name, a.introduction, a.phone, a.address, a.longitude, a.latitude, 
	        a.if_reserve_man, a.if_reserve_phone, a.if_remark, a.pay_mode,a.if_sms, a.sms_phone, a.if_check_out, 
	        a.if_food, a.if_bulletin,a.bulletin, a.if_remnant_room, a.if_continue, a.if_confirm_info, a.if_breakfast, 
	        a.breakfast_quantity, a.if_activity_prices, a.if_free_deposit, a.if_last_check_out, a.if_group_buy, a.if_spike, 
	        a.if_hour, a.if_special, a.food_pay_mode AS foodPayMode, a.check_out_phone AS checkOutPhone, a.if_invoice AS ifInvoice, 
        	a.neek_prompt AS neekPrompt, a.unneek_prompt AS unneekPrompt, a.creator, a.create_time, a.update_time, 
        	b.`name` logoName, b.url logoUrl, c.business_name, c.address businessAddress, c.telephone 
		FROM t_erp_hotel a 
		LEFT JOIN (SELECT subjection_id, `name`, url FROM t_erp_hotel_image WHERE subjection = 0 AND type = 'logo') b ON a.id = b.subjection_id 
		LEFT JOIN t_wx_shop c ON a.shop_id = c.id  
		<where>
			<if test="bus_id != null">
				AND a.bus_id = #{bus_id} 
			</if>
			<if test="id != null">
				AND a.id = #{id} 
			</if>
			<if test="keyword != null">
				AND (a.phone LIKE #{keyword} OR a.name LIKE #{keyword} OR a.address LIKE #{keyword} ) 
			</if>
		</where>
		GROUP BY a.id 
		<if test="page != null">
			LIMIT #{page},#{pageSize} 
		</if>
	</select>
	
	<select id="selectHotelAndImagePageCount" resultType="Integer" parameterType="Map">
		SELECT COUNT(z.id) 
		FROM (
			SELECT a.id  
			FROM t_erp_hotel a 
			LEFT JOIN (SELECT subjection_id, `name`, url FROM t_erp_hotel_image WHERE subjection = 0 AND type = 'logo') b ON a.id = b.subjection_id 
			LEFT JOIN t_wx_shop c ON a.shop_id = c.id 
			<where>
				<if test="bus_id != null">
					AND a.bus_id = #{bus_id} 
				</if>
				<if test="id != null">
					AND a.id = #{id} 
				</if>
				<if test="keyword != null">
					AND (a.phone LIKE #{keyword} OR a.name LIKE #{keyword} OR a.address LIKE #{keyword} ) 
				</if>
			</where>
			GROUP BY a.id 
		) z 
		
	</select>
	
	<select id="selectHotelShop" resultType="com.gt.hotel.entity.TErpHotelShop" parameterType="Map">
		SELECT t_wx_shop.id, business_name businessName, address businessAddress, telephone, local_address localAddress, wx_address wxAddress 
		FROM t_wx_shop 
		LEFT JOIN t_wx_shop_photo ON t_wx_shop.id = t_wx_shop_photo.shop_id 
		<where>
			<if test="bus_id != null">
				t_wx_shop.bus_id = #{bus_id} 
			</if>
		</where>
		<if test="page != null">
			LIMIT #{page},#{pageSize} 
		</if>
	</select>
	
	<select id="selectHotelShopCount" resultType="Integer" parameterType="Map">
		SELECT COUNT(id)  
		FROM t_wx_shop 
		<where>
			<if test="bus_id != null">
				bus_id = #{bus_id} 
			</if>
		</where>
	</select>
	
</mapper>
