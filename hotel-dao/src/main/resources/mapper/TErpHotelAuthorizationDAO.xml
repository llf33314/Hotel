<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gt.hotel.dao.TErpHotelAuthorizationDAO">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.gt.hotel.entity.TErpHotelAuthorization">
		<id column="id" property="id" />
		<result column="hotel_id" property="hotelId" />
		<result column="shop_id" property="shopId" />
		<result column="account_id" property="accountId" />
		<result column="function_id" property="functionId" />
		<result column="creator" property="creator" />
		<result column="create_time" property="createTime" />
	</resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, shop_id AS shopId, account_id AS accountId, function_id AS functionId, creator, create_time AS createTime
    </sql>

	<select id="selectShopAccountPage" resultType="com.gt.hotel.entity.TCommonStaff" parameterType="Map">
		SELECT id, name, shop_id shopId, phone FROM t_common_staff 
		<where>
			<if test="shopId != null">
				AND shop_id = #{shopId} 
			</if>
		</where>
		<if test="page != null">
			LIMIT #{page},#{pageSize} 
		</if>
	</select>
	
	<select id="selectShopAccountPageCount" resultType="Integer" parameterType="Map">
		SELECT COUNT(id) FROM t_common_staff 
		<where>
			<if test="shopId != null">
				AND shop_id = #{shopId} 
			</if>
		</where>
	</select>
	
	<select id="selectAuthorPage" resultType="com.gt.hotel.entity.TErpHotelAuthorizationVS" parameterType="Map">
		SELECT a.id, a.shop_id AS shopId, a.account_id AS accountId, 
			c.business_name shopName, b.`name` accountName, b.phone accountPhone, GROUP_CONCAT(d.function_name) funcs 
		FROM t_erp_hotel_authorization a 
		JOIN t_common_staff b ON a.account_id=b.id 
		JOIN t_wx_shop c ON a.shop_id=c.id 
		LEFT JOIN t_erp_hotel_function d ON a.function_id=d.id 
		<where>
			<if test="shop_id != null">
				AND a.shop_id IN  
				<foreach collection="shop_id" item="sid" open="(" close=")" index="index" separator=",">
					#{sid} 
				</foreach>
			</if>
		</where> 
		GROUP BY b.id 
		<if test="page != null">
			LIMIT #{page},#{pageSize} 
		</if>
	</select>
	
	<select id="selectAuthorPageCount" resultType="Integer" parameterType="Map">
		SELECT COUNT(z.id) 
		FROM (
		SELECT b.id 
		FROM t_erp_hotel_authorization a 
		JOIN t_common_staff b ON a.account_id=b.id 
		JOIN t_wx_shop c ON a.shop_id=c.id 
		LEFT JOIN t_erp_hotel_function d ON a.function_id=d.id 
		<where>
			<if test="shop_id != null">
				AND a.shop_id IN  
				<foreach collection="shop_id" item="sid" open="(" close=")" index="index" separator=",">
					#{sid} 
				</foreach>
			</if>
		</where> 
		GROUP BY b.id
		) z 
	</select>
	
</mapper>
